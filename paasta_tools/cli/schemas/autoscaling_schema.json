{
    "$id": "autoscaling_schema.json",
    "metrics_provider_config": {
        "type": "object",
        "properties": {
            "type": {
                "enum": [
                    "uwsgi",
                    "uwsgi-v2",
                    "cpu",
                    "memory",
                    "piscina",
                    "gunicorn",
                    "active-requests",
                    "arbitrary-promql",
                    "worker-load"
                ]
            },
            "decision_policy": {
                "type": "string"
            },
            "desired_active_requests_per_replica": {
                "type": "number"
            },
            "setpoint": {
                "type": "number"
            },
            "max_instances_alert_threshold": {
                "type": "number"
            },
            "forecast_policy": {
                "enum": [
                    "moving_average",
                    "current"
                ]
            },
            "moving_average_window_seconds": {
                "type": "integer",
                "minimum": 60
            },
            "metrics_query": {
                "type": "string"
            },
            "series_query": {
                "type": "string"
            },
            "target_type": {
                "enum": [
                    "Value",
                    "AverageValue"
                ],
                "default": "AverageValue"
            },
            "resources": {
                "type": "object",
                "additionalProperties": false,
                "properties": {
                    "overrides": {
                        "type": "object"
                    },
                    "template": {
                        "type": "string"
                    }
                }
            }
        },
        "additionalProperties": false
    },
    "autoscaling_params": {
        "type": "object",
        "properties": {
            "metrics_providers": {
                "type": "array",
                "items": {
                    "$ref": "#metrics_provider_config"
                }
            },
            "scaledown_policies": {
                "type": "object"
            }
        },
        "additionalProperties": false
    }
}
