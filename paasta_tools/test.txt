avg_over_time( (   ( sum(  avg( paasta_instance:envoy_cluster__egress_cluster_upstream_rq_active{paasta_cluster='norcal-stagef',paasta_service='example_happyhour_java',paasta_instance='main'} ) by (kube_pod, kube_deployment)  ) by (kube_deployment) + ( clamp_min(  (sum( k8s:deployment:pods_status_ready{paasta_cluster='norcal-stagef',paasta_service='example_happyhour_java',paasta_instance='main'} >= 0 or max_over_time( k8s:deployment:pods_status_ready{paasta_cluster='norcal-stagef',paasta_service='example_happyhour_java',paasta_instance='main'}[100s] ) ) by (kube_deployment)) - count( avg( paasta_instance:envoy_cluster__egress_cluster_upstream_rq_active{paasta_cluster='norcal-stagef',paasta_service='example_happyhour_java',paasta_instance='main'} ) by (kube_pod, kube_deployment) ) by (kube_deployment), 0 ) * 2) ) / 2  )[1800s:] ) / sum( label_join( ( kube_deployment_spec_replicas{paasta_cluster='norcal-stagef',deployment='example--happyhour--java-main',namespace='paastasvc-example--happyhour--java'} >= 0 or max_over_time( kube_deployment_spec_replicas{paasta_cluster='norcal-stagef',deployment='example--happyhour--java-main',namespace='paastasvc-example--happyhour--java'}[100s] ) ), "kube_deployment", "", "deployment" ) ) by (kube_deployment)